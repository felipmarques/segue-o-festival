<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="src/css/eventossalvos.css" />
  <title>Segue o Festival</title>
</head>
<body>
  <header>
    <nav id="sidebar">
      <div id="sidebar_content">
        <div id="user">
          <img src="src/images/avatar.avif" id="user_avatar" alt="Avatar" />
          <p id="user_infos">
            <span class="item-description">Olá, Lorena!</span>
          </p>
        </div>

        <ul id="side_items">
          <li class="side-item"><a href="https://segue-o-festival.vercel.app/"><i class="fa-solid fa-house"></i><span class="item-description">Home</span></a></li>
          <li class="side-item"><a href="https://segue-o-festival.vercel.app/perfil.html"><i class="fa-solid fa-user"></i><span class="item-description">Perfil</span></a></li>
          <li class="side-item active"><a href="#"><i class="fa-solid fa-star"></i><span class="item-description">Meus Eventos</span></a></li>
          <li class="side-item"><a href="#"><i class="fa-solid fa-calendar"></i><span class="item-description">Próximos Eventos</span></a></li>
          <li class="side-item"><a href="#"><i class="fa-solid fa-location-dot"></i><span class="item-description">Perto de Mim</span></a></li>
        </ul>

        <button id="open_btn">
          <i id="open_btn_icon" class="fa-solid fa-chevron-right"></i>
        </button>
      </div>

      <div id="logout">
        <button id="logout_btn">
          <i class="fa-solid fa-right-from-bracket"></i>
          <span class="item-description">Logout</span>
        </button>
      </div>
    </nav>
  </header>

  <main>
    <h1 class="cabecalho-titulo">Segue<br />O Festival</h1>

    <section class="conteudo-secundario">
      <div class="conteudo-secundario-destaque">
        <h1>Meus Eventos</h1>
        <a href="#">
          <div class="filtro">
            <i class="fa-solid fa-filter"></i>
          </div>
        </a>
      </div>

      <div class="conteudo-secundario-primeiralinha" id="eventosContainer">
        <!-- Eventos dinâmicos serão inseridos aqui -->
      </div>
    </section>

    <div class="paginacao">
      <a href="pagina1.html" class="ativo">1</a>
      <a href="pagina2.html">2</a>
      <a href="pagina3.html">3</a>
    </div>

    <footer class="rodape">
      <h3 class="titulo-rodape">Segue<br />O Festival!</h3>

      <div class="rodape-links">
        <div class="menu-hover">
          <div>
            <span class="rodape-direcionamento" onclick="toggleLista('listaEventos')">Encontre Eventos</span>
            <ul class="lista-escondida" id="listaEventos">
              <li>Festival A</li>
              <li>Festival B</li>
              <li>Festival C</li>
            </ul>
          </div>

          <div>
            <span class="rodape-direcionamento" onclick="toggleLista('listaCidades')">Cidades</span>
            <ul class="lista-escondida" id="listaCidades">
              <li>São Paulo</li>
              <li>Rio de Janeiro</li>
              <li>Belo Horizonte</li>
              <li>Curitiba</li>
            </ul>
          </div>

          <div>
            <span class="rodape-direcionamento" onclick="toggleLista('listaCategorias')">Categorias</span>
            <ul class="lista-escondida" id="listaCategorias">
              <li>Festival</li>
              <li>Show</li>
              <li>Religioso</li>
              <li>Carnaval</li>
              <li>Festa Junina</li>
              <li>Ano Novo</li>
            </ul>
          </div>

          <div>
            <span class="rodape-direcionamento" onclick="toggleLista('listaParaPromotores')">Para Promotores</span>
            <ul class="lista-escondida" id="listaParaPromotores">
              <li>Cadastrar Evento</li>
              <li>Contato</li>
            </ul>
          </div>

          <a href="https://cadastro-organizador.vercel.app/faq.html" class="rodape-direcionamento">Ajuda</a>
        </div>
      </div>

      <div class="direitos-reservados">
        &copy; 2025 Segue o Festival. Todos os direitos reservados.
      </div>
    </footer>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const eventosSalvos = JSON.parse(localStorage.getItem("eventosSalvos")) || [];
  
      if (eventosSalvos.length === 0) {
        document.getElementById("eventos-lista").innerHTML = "<p>Você ainda não salvou nenhum evento.</p>";
        return;
      }
  
      try {
        const response = await fetch('/api/buscaeventos');
        if (!response.ok) throw new Error("Erro ao buscar eventos");
  
        const todosEventos = await response.json();
  
        const eventosFiltrados = todosEventos.filter(evento =>
          eventosSalvos.includes(evento.id_evento)
        );
  
        const container = document.getElementById("eventos-lista");
        container.innerHTML = "";
  
        eventosFiltrados.forEach(evento => {
          const div = document.createElement("div");
          div.className = 'conteudo-secundario-item';
          div.style.cursor = 'pointer';
          div.onclick = () => {
            window.location.href = `pagina_evento.html?id=${evento.id_evento}`;
          };
  
          const imagem = document.createElement("img");
          imagem.src = evento.imagem
            ? `data:image/jpeg;base64,${evento.imagem}`
            : '/img/default.jpg';
          imagem.alt = evento.nome;
  
          const titulo = document.createElement("h3");
          titulo.textContent = evento.nome;
  
          const data = document.createElement("p");
          if (evento.data) {
            const dataEvento = new Date(evento.data);
            const dataFormatada = dataEvento.toLocaleDateString('pt-BR', {
              day: '2-digit',
              month: '2-digit',
              year: 'numeric'
            });
            const diaSemana = dataEvento.toLocaleDateString('pt-BR', {
              weekday: 'long'
            });
            data.textContent = `${dataFormatada} - ${diaSemana.charAt(0).toUpperCase() + diaSemana.slice(1)}`;
          } else {
            data.textContent = 'Data não informada';
          }
  
          const local = document.createElement("p");
          local.textContent = evento.endereco || 'Local não informado';
  
          div.appendChild(imagem);
          div.appendChild(titulo);
          div.appendChild(data);
          div.appendChild(local);
          container.appendChild(div);
        });
  
      } catch (error) {
        console.error("Erro ao carregar eventos:", error);
        document.getElementById("eventos-lista").innerHTML = "<p>Erro ao carregar eventos salvos.</p>";
      }
    });
</script>

</body>
</html>
