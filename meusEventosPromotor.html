<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link rel="stylesheet" href="css/meusEventosPromotor.css">
    <title>Segue o Festival</title>
    <style>
        .evento-card {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-width: 350px;
        }

        .evento-nome {
            font-size: 1.2rem;
            margin: 0 0 8px 0;
            color: #333;
            font-weight: 600;
        }

        .evento-data, .evento-local {
            font-size: 0.9rem;
            color: #555;
            margin: 6px 0;
            display: flex;
            align-items: center;
        }

        .evento-data i, .evento-local i {
            margin-right: 8px;
            color: #666;
            width: 16px;
            text-align: center;
        }

        .evento-botoes {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #eee;
        }

        .botao-editar, .botao-excluir {
            padding: 6px 12px;
            font-size: 0.85rem;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .botao-editar {
            background-color: #f0f0f0;
            color: #333;
        }

        .botao-excluir {
            background-color: #f8f8f8;
            color: #d32f2f;
        }
    </style>
</head>
<body>
    <header class="cabecalho">
        <div class="cabecalho-botoes">
            <button class="cabecalho-botao-entrar" onclick="location.href='inserir_eventos.html'">Cadastrar Eventos</button>
            <button class="cabecalho-botao-entrar" onclick="location.href='perfil.html'">Meu Perfil</button>
            <button class="cabecalho-botao-entrar" onclick="location.href='faq.html'">FAQ</button>
        </div>
    </header>

    <main>        
        <h1 class="cabecalho-titulo">Segue<br>O Festival!</h1>

        <section class="conteudo-secundario">
            <div class="conteudo-secundario-destaque">
                <h1>Meus Eventos</h1>
            </div>
    
            <div class="conteudo-secundario-primeiralinha" id="lista-eventos">
                <!-- Eventos serão inseridos aqui dinamicamente -->
            </div>
        </section>
    </main>

    <script>
        function formatarData(dataISO) {
            const data = new Date(dataISO);
            const dia = String(data.getDate()).padStart(2, '0');
            const mes = String(data.getMonth() + 1).padStart(2, '0');
            const ano = data.getFullYear();
            return `${dia}/${mes}/${ano}`;
        }

        function formatarDiaSemana(dataISO) {
            const dias = ['Domingo', 'Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado'];
            const data = new Date(dataISO);
            return dias[data.getDay()];
        }

        async function carregarEventos() {
            const cnpjUsuario = localStorage.getItem("cnpjUsuario");
            const listaEventos = document.getElementById("lista-eventos");

            try {
                const resposta = await fetch(`https://segue-o-festival.vercel.app/api/meusEventosPromotor?cnpj=${cnpjUsuario}`);
                const eventos = await resposta.json();

                listaEventos.innerHTML = '';

                eventos.forEach(evento => {
                    const eventoDiv = document.createElement("div");
                    eventoDiv.innerHTML = `
                        <div class="evento-card">
                            <h3 class="evento-nome">${evento.nome}</h3>
                            <div class="evento-data">
                                <i class="fas fa-calendar"></i> ${formatarData(evento.data)} - ${formatarDiaSemana(evento.data)}
                            </div>
                            <div class="evento-local">
                                <i class="fas fa-map-marker-alt"></i> ${evento.endereco}
                            </div>
                            <div class="evento-botoes">
                                <button class="botao-editar" onclick="editarEvento(${evento.id_evento})">
                                    <i class="fas fa-pencil-alt"></i> Editar
                                </button>
                                <button class="botao-excluir" onclick="confirmarExclusao(${evento.id_evento})">
                                    <i class="fas fa-trash"></i> Excluir
                                </button>
                            </div>
                        </div>
                    `;
                    listaEventos.appendChild(eventoDiv);
                });

            } catch (error) {
                console.error("Erro:", error);
                listaEventos.innerHTML = "<p>Erro ao carregar eventos</p>";
            }
        }

        function editarEvento(idEvento) {
            window.location.href = `editar_evento.html?id=${idEvento}`;
        }

        function confirmarExclusao(idEvento) {
            if (confirm("Tem certeza que deseja excluir este evento?")) {
                excluirEvento(idEvento);
            }
        }

        async function excluirEvento(idEvento) {
            try {
                const cnpjUsuario = localStorage.getItem("cnpjUsuario");
                const resposta = await fetch(`https://segue-o-festival.vercel.app/api/meusEventosPromotor?cnpj=${cnpjUsuario}&id_evento=${idEvento}`, {
                    method: 'DELETE'
                });
                
                if (resposta.ok) {
                    carregarEventos();
                }
            } catch (error) {
                console.error("Erro:", error);
            }
        }

        document.addEventListener("DOMContentLoaded", carregarEventos);
    </script>
</body>
</html>
