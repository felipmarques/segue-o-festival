<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="src/css/eventossalvos.css" />
  <title>Segue o Festival</title>
</head>
<body>
  <header>
    <nav id="sidebar">
      <div id="sidebar_content">
        <div id="user">
          <img src="src/images/avatar.jpg" id="user_avatar" alt="Avatar" />
          <p id="user_infos">
            <span class="item-description">Olá, <span id="nomeUsuario">Usuário</span>!</span>
          </p>
        </div>
        <ul id="side_items">
          <li class="side-item">
            <a href="https://segue-o-festival.vercel.app/">
              <i class="fa-solid fa-house"></i>
              <span class="item-description">Home</span>
            </a>
          </li>
          <li class="side-item">
            <a href="https://segue-o-festival.vercel.app/perfil.html">
              <i class="fa-solid fa-user"></i>
              <span class="item-description">Perfil</span>
            </a>
          </li>
          <li class="side-item active">
            <a href="#">
              <i class="fa-solid fa-star"></i>
              <span class="item-description">Meus Eventos</span>
            </a>
          </li>
          <li class="side-item">
            <a href="#">
              <i class="fa-solid fa-calendar"></i>
              <span class="item-description">Próximos Eventos</span>
            </a>
          </li>
          <li class="side-item">
            <a href="#">
              <i class="fa-solid fa-location-dot"></i>
              <span class="item-description">Perto de Mim</span>
            </a>
          </li>
        </ul>
        <button id="open_btn">
          <i id="open_btn_icon" class="fa-solid fa-chevron-right"></i>
        </button>
      </div>
      <div id="logout">
        <button id="logout_btn">
          <i class="fa-solid fa-right-from-bracket"></i>
          <span class="item-description">Logout</span>
        </button>
      </div>
    </nav>
  </header>

  <main>
    <h1 class="cabecalho-titulo">Segue<br>O Festival</h1>
    <section class="conteudo-secundario">
      <div class="conteudo-secundario-destaque">
        <h1>Meus Eventos</h1>
        <a href="#">
          <div class="filtro">
            <i class="fa-solid fa-filter"></i>
          </div>
        </a>
      </div>
      <div id="eventosContainer" class="conteudo-secundario-eventos">
        <!-- Eventos salvos serão inseridos aqui dinamicamente -->
      </div>
    </section>
    <div class="paginacao">
      <a href="pagina1.html" class="ativo">1</a>
      <a href="pagina2.html">2</a>
      <a href="pagina3.html">3</a>
    </div>
    <footer class="rodape">
      <h3 class="titulo-rodape">Segue<br>O Festival!</h3>
      <div class="rodape-links">
        <div class="menu-hover">
          <div>
            <span class="rodape-direcionamento" onclick="toggleLista('listaEventos')">Encontre Eventos</span>
            <ul class="lista-escondida" id="listaEventos">
              <li>Festival A</li>
              <li>Festival B</li>
              <li>Festival C</li>
            </ul>
          </div>
          <div>
            <span class="rodape-direcionamento" onclick="toggleLista('listaCidades')">Cidades</span>
            <ul class="lista-escondida" id="listaCidades">
              <li>São Paulo</li>
              <li>Rio de Janeiro</li>
              <li>Belo Horizonte</li>
              <li>Curitiba</li>
            </ul>
          </div>
          <div>
            <span class="rodape-direcionamento" onclick="toggleLista('listaCategorias')">Categorias</span>
            <ul class="lista-escondida" id="listaCategorias">
              <li>Festival</li>
              <li>Show</li>
              <li>Religioso</li>
              <li>Carnaval</li>
              <li>Festa Junina</li>
              <li>Ano Novo</li>
            </ul>
          </div>
          <div>
            <span class="rodape-direcionamento" onclick="toggleLista('listaParaPromotores')">Para Promotores</span>
            <ul class="lista-escondida" id="listaParaPromotores">
              <li>Cadastrar Evento</li>
              <li>Contato</li>
            </ul>
          </div>
          <a href="https://cadastro-organizador.vercel.app/faq.html" class="rodape-direcionamento">Ajuda</a>
        </div>
      </div>
      <div class="direitos-reservados">
        &copy; 2025 Segue o Festival. Todos os direitos reservados.
      </div>
    </footer>
  </main>

  <script>
    // Simulação de usuário logado
    const usuarioLogado = {
      email: "lorena@example.com"
    };

    // Função para buscar nome e CPF do usuário
    async function buscarUsuario(email) {
      try {
        const response = await fetch(\`/api/buscarUsuario?email=\${encodeURIComponent(email)}\`);
        if (!response.ok) throw new Error("Erro ao buscar usuário");
        return await response.json();
      } catch (error) {
        console.error("Erro ao buscar usuário:", error);
        return null;
      }
    }

    // Função para buscar eventos salvos pelo CPF
    async function buscarEventosSalvos(cpf) {
      try {
        const response = await fetch(\`/api/eventos-salvos?cpf=\${encodeURIComponent(cpf)}\`);
        if (!response.ok) throw new Error("Erro ao buscar eventos salvos");
        return await response.json();
      } catch (error) {
        console.error("Erro ao buscar eventos salvos:", error);
        return [];
      }
    }

    // Função para criar e exibir os cards de eventos
    function exibirEventos(eventos) {
      const container = document.getElementById("eventosContainer");
      container.innerHTML = ""; // Limpa o conteúdo anterior
      if (eventos.length === 0) {
        container.innerHTML = "<p>Nenhum evento salvo encontrado.</p>";
        return;
      }
      eventos.forEach(evento => {
        const card = document.createElement("div");
        card.className = "evento-card";
        card.innerHTML = \`
          <img class="conteudo-secundario-imagem" src="\${evento.imagem}" alt="Banner \${evento.nome}">
          <h3 class="conteudo-secundario-titulo">\${evento.nome}</h3>
          <p class="conteudo-secundario-paragrafo">\${evento.data}</p>
          <p class="conteudo-secundario-paragrafo">\${evento.local}</p>
        \`;
        container.appendChild(card);
      });
    }

    // Função principal para carregar os dados
    async function carregarDados() {
      if (!usuarioLogado?.email) return;
      const usuario = await buscarUsuario(usuarioLogado.email);
      if (!usuario) return;
      document.getElementById("nomeUsuario").textContent = usuario.nome;
      const eventos = await buscarEventosSalvos(usuario.cpf);
      exibirEventos(eventos);
    }

    // Chama a função principal ao carregar a página
    document.addEventListener("DOMContentLoaded", carregarDados);
  </script>
</body>
</html>
